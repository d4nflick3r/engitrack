      - name: Hide unpaid break box (UI only, runtime hide, never fails)
        run: |
          python3 - <<'PY'
          from pathlib import Path
          import re

          root = Path(r"${{ steps.findroot.outputs.root }}")
          home = root / "client/src/pages/Home.tsx"
          s = home.read_text(encoding="utf-8")

          # 1) Ensure useEffect is available
          # Try to add to existing react import: import React, { ... } from "react";
          if re.search(r'from\s+["\']react["\']', s):
            # If there is a named import block and useEffect isn't in it, add it.
            m = re.search(r'import\s+[^;]*\{\s*([^}]*)\s*\}[^;]*from\s+["\']react["\']', s)
            if m and "useEffect" not in m.group(1):
              s = re.sub(
                r'(import\s+[^;]*\{\s*)([^}]*)\s*(\}[^;]*from\s+["\']react["\'])',
                lambda mm: mm.group(1) + (mm.group(2).strip() + ", useEffect") + " " + mm.group(3),
                s,
                count=1
              )
            elif not m:
              # No named import block; add a separate import
              if 'import { useEffect } from "react";' not in s and "useEffect" not in s:
                s = 'import { useEffect } from "react";\n' + s

          # 2) Inject the useEffect inside the component (idempotent)
          marker = "/* __HIDE_UNPAID_BREAK__ */"
          if marker not in s:
            hide_js = f'''
  {marker}
  useEffect(() => {{
    try {{
      const labels = Array.from(document.querySelectorAll("label"));
      for (const l of labels) {{
        const txt = (l.textContent || "").toLowerCase();
        if (txt.includes("unpaid") && txt.includes("break")) {{
          const container = l.closest("div");
          if (container) {{
            (container).style.display = "none";
          }}
        }}
      }}
    }} catch (e) {{
      // never block the app
    }}
  }}, []);
'''
            # Put it after the first hook/useState declaration inside the component body
            # Find the opening of the component function body: "{"
            # Then insert after that.
            s2, n = re.subn(r'(export\s+default\s+function\s+Home\s*\([^)]*\)\s*\{\s*)', r'\1' + hide_js, s, count=1)
            if n == 0:
              s2, n = re.subn(r'(function\s+Home\s*\([^)]*\)\s*\{\s*)', r'\1' + hide_js, s, count=1)
              if n == 0:
                # If we can't locate it, don't fail the build
                print("WARNING: Could not locate Home component to inject hide code; skipping")
                home.write_text(s, encoding="utf-8")
                raise SystemExit(0)
            s = s2

          home.write_text(s, encoding="utf-8")
          print("OK: Unpaid break runtime-hide injected (or already present).")
          PY
